{% extends "base.html" %}

{% block title %}Manager Daughter Rankings Analysis - WUSA 7U{% endblock %}

{% block page_title %}WUSA 7U - Manager Daughter Rankings Analysis{% endblock %}

{% block content %}
    <div class="container mt-4">
        <div class="row">
            <div class="col-lg-10 offset-lg-1">
                <div class="card shadow">
                    <div class="card-body">
                        <!-- Manager Submission Status -->
                        {% if managers_without_count > 0 %}
                            <div class="alert alert-warning mb-4">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                <span
                                    data-bs-toggle="tooltip"
                                    data-bs-placement="top"
                                    data-bs-html="true"
                                    title="<strong>Managers who did not submit:</strong><br>{% for manager in managers_without_rankings %}{{ manager.first_name }} {{ manager.last_name }}<br>{% endfor %}"
                                    style="cursor: help; text-decoration: underline dotted;">
                                    {{ managers_without_count }} manager(s) have not submitted manager daughter rankings
                                </span>
                            </div>
                        {% else %}
                            <div class="alert alert-success mb-4">
                                <i class="bi bi-check-circle me-2"></i>
                                All managers have submitted manager daughter rankings
                            </div>
                        {% endif %}

                        <!-- Manager Daughter Rankings -->
                        <h5 class="mb-3">Manager Daughter Rankings (Based on Aggregate Manager Rankings)</h5>

                        <div class="alert alert-info mb-4">
                            <i class="bi bi-info-circle me-2"></i>
                            The <strong>Suggested Round</strong> is calculated as the median (middle value) of all the rounds that managers assigned to each player.
                            This represents the consensus view of which round each player should be drafted in. For example, if 5 managers placed a player
                            in rounds [1, 2, 2, 3, 2], the median is 2, so the suggested round would be Round 2.
                        </div>

                        {% if top_players %}
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered">
                                    <thead class="table-dark">
                                        <tr>
                                            <th style="width: 100px;" class="text-center">Rank</th>
                                            <th class="text-center">Player Name</th>
                                            <th style="width: 200px;" class="text-center">Suggested Round</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in top_players %}
                                            <tr>
                                                <td class="text-center">{{ forloop.counter }}</td>
                                                <td>{{ item.player.first_name }} {{ item.player.last_name }}</td>
                                                <td class="text-center">
                                                    {% if item.suggested_round %}
                                                        <span class="badge bg-success">Round {{ item.suggested_round }}</span>
                                                    {% else %}
                                                        <span class="text-muted">-</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i>
                                No manager daughter rankings have been submitted yet.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        // Initialize Bootstrap tooltips
        document.addEventListener('DOMContentLoaded', function() {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
{% endblock %}
