{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>{{ team.name }} - Game Roster</h2>

    <!-- Innings Tabs -->
    <ul class="nav nav-tabs mt-4" id="inningTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="inning1-tab" data-bs-toggle="tab" data-bs-target="#inning1" type="button" role="tab">Inning 1</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="inning2-tab" data-bs-toggle="tab" data-bs-target="#inning2" type="button" role="tab">Inning 2</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="inning3-tab" data-bs-toggle="tab" data-bs-target="#inning3" type="button" role="tab">Inning 3</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="inning4-tab" data-bs-toggle="tab" data-bs-target="#inning4" type="button" role="tab">Inning 4</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="inning5-tab" data-bs-toggle="tab" data-bs-target="#inning5" type="button" role="tab">Inning 5</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="inning6-tab" data-bs-toggle="tab" data-bs-target="#inning6" type="button" role="tab">Inning 6</button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content mt-4" id="inningTabContent">
        {% for inning in "123456" %}
        <div class="tab-pane fade {% if inning == '1' %}show active{% endif %}" id="inning{{ inning }}" role="tabpanel">
            <div class="row g-3">
                <!-- Left Column: Player List -->
                <div class="col-md-6">
                    <div class="roster-section">
                        <h5 class="section-header">Available Players</h5>
                        <div class="player-list" id="playerList{{ inning }}">
                            {% for player in team.players.all %}
                            <div class="player-card" draggable="true" data-player-id="{{ player.id }}" data-player-name="{{ player.first_name }} {{ player.last_name }}">
                                {{ player.first_name }} {{ player.last_name }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Right Column: Baseball Field -->
                <div class="col-md-6">
                    <div class="roster-section">
                        <h5 class="section-header">Field Positions</h5>
                        <div class="baseball-field" data-inning="{{ inning }}">
        <svg viewBox="0 0 600 625" class="field-svg">
            <!-- Outfield grass (rectangular box) -->
            <rect x="30" y="-12.5" width="540" height="650" fill="#6ba368" stroke="none"/>

            <!-- Infield dirt (90 foot diamond + extended areas) -->
            <path d="M 300 440 L 140 280 L 300 120 L 460 280 Z"
                  fill="#d4a574" stroke="none"/>

            <!-- Dirt cutout around pitcher/home plate -->
            <ellipse cx="300" cy="440" rx="60" ry="40" fill="#d4a574" stroke="none"/>
            <circle cx="300" cy="280" r="30" fill="#d4a574" stroke="none"/>

            <!-- Basepaths (dirt lines) -->
            <line x1="300" y1="440" x2="140" y2="280" stroke="#c19a6b" stroke-width="4"/>
            <line x1="300" y1="440" x2="460" y2="280" stroke="#c19a6b" stroke-width="4"/>
            <line x1="140" y1="280" x2="300" y2="120" stroke="#c19a6b" stroke-width="4"/>
            <line x1="460" y1="280" x2="300" y2="120" stroke="#c19a6b" stroke-width="4"/>

            <!-- Pitcher's mound -->
            <circle cx="300" cy="280" r="22" fill="#b8885c" stroke="#a67c52" stroke-width="2"/>

            <!-- Bases -->
            <rect x="295" y="115" width="10" height="10" fill="white" stroke="#999" stroke-width="1" transform="rotate(45 300 120)"/>
            <rect x="455" y="275" width="10" height="10" fill="white" stroke="#999" stroke-width="1" transform="rotate(45 460 280)"/>
            <rect x="135" y="275" width="10" height="10" fill="white" stroke="#999" stroke-width="1" transform="rotate(45 140 280)"/>

            <!-- Home plate -->
            <polygon points="300,450 295,445 295,440 305,440 305,445" fill="white" stroke="#999" stroke-width="1"/>

            <!-- Position markers (drop zones) -->
            <!-- Outfielders - spread far out -->
            <g class="position-marker" data-position="LF">
                <circle cx="100" cy="110" r="40" fill="rgba(255,255,255,0.9)" stroke="#333" stroke-width="2" class="position-circle"/>
                <text x="100" y="116" text-anchor="middle" font-size="14" font-weight="bold" fill="#666" class="position-label">LF</text>
                <text x="100" y="132" text-anchor="middle" font-size="11" fill="#333" class="player-name-display"></text>
            </g>

            <g class="position-marker" data-position="CF">
                <circle cx="300" cy="80" r="40" fill="rgba(255,255,255,0.9)" stroke="#333" stroke-width="2" class="position-circle"/>
                <text x="300" y="86" text-anchor="middle" font-size="14" font-weight="bold" fill="#666" class="position-label">CF</text>
                <text x="300" y="102" text-anchor="middle" font-size="11" fill="#333" class="player-name-display"></text>
            </g>

            <g class="position-marker" data-position="RF">
                <circle cx="500" cy="110" r="40" fill="rgba(255,255,255,0.9)" stroke="#333" stroke-width="2" class="position-circle"/>
                <text x="500" y="116" text-anchor="middle" font-size="14" font-weight="bold" fill="#666" class="position-label">RF</text>
                <text x="500" y="132" text-anchor="middle" font-size="11" fill="#333" class="player-name-display"></text>
            </g>

            <!-- Infielders - spread around diamond -->
            <g class="position-marker" data-position="3B">
                <circle cx="140" cy="280" r="40" fill="rgba(255,255,255,0.9)" stroke="#333" stroke-width="2" class="position-circle"/>
                <text x="140" y="286" text-anchor="middle" font-size="14" font-weight="bold" fill="#666" class="position-label">3B</text>
                <text x="140" y="302" text-anchor="middle" font-size="11" fill="#333" class="player-name-display"></text>
            </g>

            <g class="position-marker" data-position="SS">
                <circle cx="200" cy="200" r="40" fill="rgba(255,255,255,0.9)" stroke="#333" stroke-width="2" class="position-circle"/>
                <text x="200" y="206" text-anchor="middle" font-size="14" font-weight="bold" fill="#666" class="position-label">SS</text>
                <text x="200" y="222" text-anchor="middle" font-size="11" fill="#333" class="player-name-display"></text>
            </g>

            <g class="position-marker" data-position="2B">
                <circle cx="400" cy="200" r="40" fill="rgba(255,255,255,0.9)" stroke="#333" stroke-width="2" class="position-circle"/>
                <text x="400" y="206" text-anchor="middle" font-size="14" font-weight="bold" fill="#666" class="position-label">2B</text>
                <text x="400" y="222" text-anchor="middle" font-size="11" fill="#333" class="player-name-display"></text>
            </g>

            <g class="position-marker" data-position="1B">
                <circle cx="460" cy="280" r="40" fill="rgba(255,255,255,0.9)" stroke="#333" stroke-width="2" class="position-circle"/>
                <text x="460" y="286" text-anchor="middle" font-size="14" font-weight="bold" fill="#666" class="position-label">1B</text>
                <text x="460" y="302" text-anchor="middle" font-size="11" fill="#333" class="player-name-display"></text>
            </g>

            <g class="position-marker" data-position="P">
                <circle cx="300" cy="280" r="40" fill="rgba(255,255,255,0.9)" stroke="#333" stroke-width="2" class="position-circle"/>
                <text x="300" y="286" text-anchor="middle" font-size="14" font-weight="bold" fill="#666" class="position-label">P</text>
                <text x="300" y="302" text-anchor="middle" font-size="11" fill="#333" class="player-name-display"></text>
            </g>

            <g class="position-marker" data-position="C">
                <circle cx="300" cy="480" r="40" fill="rgba(255,255,255,0.9)" stroke="#333" stroke-width="2" class="position-circle"/>
                <text x="300" y="486" text-anchor="middle" font-size="14" font-weight="bold" fill="#666" class="position-label">C</text>
                <text x="300" y="502" text-anchor="middle" font-size="11" fill="#333" class="player-name-display"></text>
            </g>
        </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
/* Section Container Styles */
.roster-section {
    background-color: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    height: 750px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.section-header {
    font-size: 16px;
    font-weight: 600;
    color: #495057;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e9ecef;
}

/* Player List Styles */
.player-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 4px;
}

.player-card {
    padding: 12px 16px;
    background-color: white;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    font-size: 14px;
    text-align: left;
    cursor: grab;
    transition: all 0.2s;
}

.player-card:hover {
    background-color: #f8f9fa;
    border-color: #0d6efd;
    transform: translateX(3px);
}

.player-card:active {
    cursor: grabbing;
    opacity: 0.6;
}

.player-card.dragging {
    opacity: 0.4;
}

/* Baseball Field Styles */
.baseball-field {
    width: 100%;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f8f9fa;
    border-radius: 4px;
    padding: 20px;
}

.field-svg {
    width: 90%;
    height: 90%;
    max-width: none;
}

.position-marker {
    cursor: pointer;
    transition: all 0.2s;
}

.position-marker:hover .position-circle {
    fill: rgba(13, 110, 253, 0.1);
    stroke: #0d6efd;
}

.position-marker.has-player .position-circle {
    fill: rgba(25, 135, 84, 0.2);
    stroke: #198754;
}

.player-name-display {
    font-weight: 600;
    fill: #333;
}

/* Tab Styles */
.nav-tabs .nav-link {
    color: #6c757d;
}

.nav-tabs .nav-link.active {
    color: #0d6efd;
    font-weight: 500;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const rosterId = {{ roster.id }};
    const teamSecret = '{{ team.manager_secret }}';

    // Initialize drag and drop for each inning
    for (let inning = 1; inning <= 6; inning++) {
        initializeDragAndDrop(inning);
        loadPositions(inning);
    }

    function initializeDragAndDrop(inning) {
        const playerCards = document.querySelectorAll(`#playerList${inning} .player-card`);
        const positionMarkers = document.querySelectorAll(`[data-inning="${inning}"] .position-marker`);

        // Make player cards draggable
        playerCards.forEach(card => {
            card.addEventListener('dragstart', function(e) {
                e.dataTransfer.setData('playerId', this.dataset.playerId);
                e.dataTransfer.setData('playerName', this.dataset.playerName);
                this.classList.add('dragging');
            });

            card.addEventListener('dragend', function() {
                this.classList.remove('dragging');
            });
        });

        // Make position markers droppable
        positionMarkers.forEach(marker => {
            marker.addEventListener('dragover', function(e) {
                e.preventDefault();
            });

            marker.addEventListener('drop', function(e) {
                e.preventDefault();
                const playerId = e.dataTransfer.getData('playerId');
                const playerName = e.dataTransfer.getData('playerName');
                const position = this.dataset.position;

                // Update display
                const nameDisplay = this.querySelector('.player-name-display');
                nameDisplay.textContent = playerName;
                this.classList.add('has-player');

                // Save to database
                savePosition(inning, position, playerId, playerName);
            });
        });
    }

    function savePosition(inning, position, playerId, playerName) {
        // TODO: Implement AJAX call to save position to database
        console.log(`Saving: Inning ${inning}, Position ${position}, Player ${playerId} (${playerName})`);
    }

    function loadPositions(inning) {
        // TODO: Implement AJAX call to load positions from database
        console.log(`Loading positions for inning ${inning}`);
    }
});
</script>
{% endblock %}
